<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Calendar</title>
  <style>
    body { margin: 0; font-size: 20px; font-family: sans-serif; background: #f3f2f2; color: #333; }
    .date-bar { background: #007acc; color: white; padding: 10px; text-align: center; font-size: 1.5em; position: fixed; width: 100%; top: 0; }
    .slide { display: none; padding: 60px 20px 0 20px; height: 100vh; box-sizing: border-box; overflow: hidden; }
    .slide.active { display: block; }
    h2 { text-align: center; font-size: 1.5em; margin: 10px 0; }

    .calendar-grid {
      display: grid;
      grid-template-columns: auto repeat(21, 1fr);
      grid-template-rows: auto repeat(32, 1fr);
      height: calc(100vh - 175px);
      position: relative;
    }
    .hour-label {
      font-weight: bold;
      text-align: right;
      padding: 0 10px;
      border-right: 1px solid #ccc;
      background-color: #f3f2f2;
      font-size: 0.8em;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }
    .day-label {
      grid-column: span 3;
      text-align: center;
      background-color: #cdcdd1;
      border: 1px solid #ccc;
      font-size: 1em;
      padding: 6px;
      font-weight: bold;
    }
    .day {
      border: 1px solid #ccc;
      position: relative;
    }
    .event-block {
      position: absolute;
      padding: 2px;
      border-radius: 4px;
      box-sizing: border-box;
      color: #000;
      font-size: 0.75em;
      font-weight: bold;
      text-align: center;
      word-break: break-word;
      white-space: normal;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .appt { background-color: #ffd966; }
    .school { background-color: #d9ead3; }
    .work { background-color: #f9cb9c; }
    .house { background-color: #a4c2f4; }
    .other { background-color: #e0e0e0; }
  </style>
</head>
<body>
  <div class="date-bar" id="dateBar"></div>
  <div id="slides">
    <div class="slide active" id="calendar-am">
      <h2>Weekly Calendar (AM)</h2>
      <div class="calendar-grid" id="calendarAM"></div>
    </div>
  </div>
  <script>
    const dateBar = document.getElementById("dateBar");
    dateBar.innerText = new Date().toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

    function formatTime(hour, minute) {
      const ampm = hour >= 12 ? "PM" : "AM";
      const h = hour % 12 || 12;
      const m = minute.toString().padStart(2, "0");
      return `${h}:${m} ${ampm}`;
    }

    function buildCalendar(containerId, startHour, endHour, events) {
      const container = document.getElementById(containerId);
      const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      const members = ["Leo", "Autumn", "Cole"];
      const totalBlocks = (endHour - startHour) * 4 + 1;

      container.innerHTML = '<div class="hour-label"></div>' + days.map(() => '<div class="day-label">Day</div>').join('').repeat(1);

      for (let t = 0; t < totalBlocks; t++) {
        const hour = Math.floor((startHour * 4 + t) / 4);
        const minute = ((startHour * 4 + t) % 4) * 15;
        const timeLabel = (minute === 0 || minute === 30) ? formatTime(hour, minute) : "";
        container.innerHTML += `<div class="hour-label">${timeLabel}</div>` + '<div class="day"></div>'.repeat(21);
      }

      (events || []).forEach(event => {
        const dayIndex = days.indexOf(Array.isArray(event.day) ? event.day[0] : event.day);
        const memberIndex = members.indexOf(event.member);
        if (dayIndex === -1 || memberIndex === -1) return;

        const [h, m] = event.time.match(/\d+/g).map(Number);
        const ampm = event.time.includes("PM") && h !== 12 ? 12 : 0;
        const startMin = (h % 12 + ampm) * 60 + m;
        const blockStart = Math.floor((startMin - startHour * 60) / 15);
        const span = event.duration || 1;

        const top = (blockStart / totalBlocks) * 100;
        const height = (span / totalBlocks) * 100;
        const col = dayIndex * 3 + memberIndex + 1;
        const gridColumn = col + 1;

        const div = document.createElement("div");
        div.className = `event-block ${event.category}`;
        div.textContent = event.event;
        div.style.gridColumn = gridColumn;
        div.style.gridRow = `${blockStart + 2} / span ${span}`;

        container.appendChild(div);
      });
    }

    fetch("assets/data.json")
      .then(res => res.json())
      .then(data => {
        buildCalendar("calendarAM", 7, 14.75, data.calendar);
      });
  </script>
</body>
</html>

