<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Calendar</title>
  <style>
    body { 
      margin: 0; 
      font-size: 20px; 
      font-family: sans-serif; 
      background: #f3f2f2; 
      color: #333; 
    }
    .date-bar { 
      background: #007acc; 
      color: white; 
      padding: 10px; 
      text-align: center; 
      font-size: 1.5em; 
      position: fixed; 
      width: 100%; 
      top: 0; 
    }
    .slide { 
      display: none; 
      padding: 60px 20px 20px; 
      min-height: 100vh; 
      box-sizing: border-box; 
    }
    .slide.active { 
      display: block; 
    }
    h2 { 
      text-align: center; 
      padding: 3px 10px; 
      font-size: 1.5em; 
    }
    /* Updated grid: one column for time labels + 21 equal member columns (7 days x 3 members) */
    .calendar-grid { 
      display: grid; 
      grid-template-columns: auto repeat(21, minmax(0, 1fr)); 
      grid-auto-rows: 50px; /* forces all rows to be equal in height */
      gap: 0; 
      height: calc(100vh - 175px); 
    }
    .calendar-grid .day, .calendar-grid .day-label, .calendar-grid .hour-label {
      box-sizing: border-box;
      border: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .day { 
      font-size: 1.25em; 
      text-align: center; 
    }
    .event-block { 
      padding: 8px; 
      border-radius: 4px; 
      display: block; 
      width: 100%; 
      box-sizing: border-box; 
      color: #000; 
      font-size: 0.9em; 
      font-weight: bold; 
      height: 100%; 
    }
    .hour-label {
      font-weight: bold;
      font-size: 0.8em;
      padding: 4px;
      background-color: #f3f2f2;
    }
    .day-label { 
      font-weight: bold; 
      background-color: #cdcdd1; 
      font-size: 1em; 
      padding: 6px; 
    }
    
    .dinner { 
      max-width: 90vw; 
      margin: 50px auto; 
      font-size: 2em; 
      text-align: center; 
      min-height: calc(100vh - 120px); 
      padding-bottom: 2vh; 
      overflow-wrap: break-word; 
    }
    .birthdays, .chores { 
      max-width: 100%; 
      margin: 50px auto; 
      font-size: 2em; 
      text-align: center; 
    }
    .reminder { 
      font-size: 2em; 
      text-align: center; 
      margin-top: 100px; 
    }
    .reminder h2 { 
      font-size: 1em; 
      font-weight: bold; 
    }
    .reminder p { 
      font-size: .8em; 
    }
    
    .appt { background-color: #ffd966; }
    .school { background-color: #d9ead3; }
    .work { background-color: #f9cb9c; }
    .house { background-color: #a4c2f4; }
    .other { background-color: #e0e0e0; }
  </style>
</head>
<body>
  <div class="date-bar" id="dateBar"></div>
  <div id="slides">
    <div class="slide" id="calendar-am">
      <h2>Weekly Calendar (AM)</h2>
      <div class="calendar-grid" id="calendarAM"></div>
    </div>
    <div class="slide" id="calendar-pm">
      <h2>Weekly Calendar (PM)</h2>
      <div class="calendar-grid" id="calendarPM"></div>
    </div>
    <div class="slide" id="dinner-slide">
      <h2>Dinner Today</h2>
      <div class="dinner" id="dinners"></div>
    </div>
    <div class="slide" id="birthday-slide">
      <h2>Birthdays This Week</h2>
      <div class="birthdays" id="birthdays"></div>
    </div>
    <div class="slide" id="reminder-slide">
      <div class="reminder" id="reminderBox"></div>
    </div>
    <div class="slide" id="chores-slide">
      <h2>Daily Tasks</h2>
      <div class="chores" id="chores"></div>
    </div>
  </div>
  
  <script>
    const dateBar = document.getElementById("dateBar");
    const today = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    dateBar.innerText = today.toLocaleDateString(undefined, options);
    
    const dayOfWeek = today.toLocaleDateString(undefined, { weekday: 'long' });
    
    const slides = [
      "calendar-am",
      "calendar-pm",
      "dinner-slide",
      "birthday-slide",
      "chores-slide"
    ];
    
    let current = 0;
    function showSlide(index) {
      slides.forEach(id => document.getElementById(id).classList.remove("active"));
      document.getElementById(slides[index]).classList.add("active");
    }
    showSlide(current);
    setInterval(() => {
      current = (current + 1) % slides.length;
      showSlide(current);
    }, 5000);
    
    function formatTime(hour, minute) {
      const ampm = hour >= 12 ? "PM" : "AM";
      const h = hour % 12 || 12;
      const m = minute.toString().padStart(2, "0");
      return `${h}:${m} ${ampm}`;
    }
    
    function timeToMinutes(timeStr) {
      const [time, modifier] = timeStr.split(' ');
      let [hours, minutes] = time.split(':').map(Number);
      if (modifier.toUpperCase() === "PM" && hours !== 12) hours += 12;
      if (modifier.toUpperCase() === "AM" && hours === 12) hours = 0;
      return hours * 60 + minutes;
    }
    
    function buildCalendarSection(containerElement, startHour, endHour, calendarData) {
      const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      const members = ["Alice", "Bob", "Charlie"]; // update member names as needed
      
      // Clear previous content and build header rows
      containerElement.innerHTML = '';
      
      // First header row: blank cell for time labels, then each day spanning 3 columns
      containerElement.innerHTML += `<div class="hour-label"></div>`;
      days.forEach(day => {
        containerElement.innerHTML += `<div class="day-label" style="grid-column: span 3;">${day}</div>`;
      });
      
      // Second header row: blank cell, then member names for each day (each in its own cell)
      containerElement.innerHTML += `<div class="hour-label"></div>`;
      days.forEach(day => {
        members.forEach(member => {
          containerElement.innerHTML += `<div class="day-label">${member}</div>`;
        });
      });
      
      // Prepare a blocked structure for each day/member to handle multi-slot events
      const blocked = {};
      days.forEach(day => {
        blocked[day] = {};
        members.forEach(member => {
          blocked[day][member] = {};
        });
      });
      
      // Loop through time slots (each half-hour)
      for (let t = startHour * 2; t <= endHour * 2; t++) {
        const hour = Math.floor(t / 2);
        const minute = (t % 2 === 0) ? 0 : 30;
        const label = formatTime(hour, minute);
        containerElement.innerHTML += `<div class="hour-label">${label}</div>`;
        
        // For each day, create a cell for each member
        days.forEach(day => {
          members.forEach(member => {
            // Skip cell if already blocked by a spanning event
            if (blocked[day][member][label]) return;
            
            // Look for an event matching day, time, and member
            const event = (calendarData || []).find(e =>
              e.day === day && e.time === label && e.member === member
            );
            if (event) {
              const span = event.duration || 1;
              containerElement.innerHTML += `<div class="day" style="grid-row: span ${span};">
                <div class="event-block ${event.category}">${event.event}</div>
              </div>`;
              // Block subsequent half-hour slots for this event
              for (let offset = 1; offset < span; offset++) {
                let totalMinutes = timeToMinutes(label) + offset * 30;
                let blockHour = Math.floor(totalMinutes / 60);
                let blockMinute = totalMinutes % 60;
                let blockLabel = formatTime(blockHour, blockMinute);
                blocked[day][member][blockLabel] = true;
              }
            } else {
              containerElement.innerHTML += `<div class="day"></div>`;
            }
          });
        });
      }
    }
    
    fetch("assets/data.json")
      .then(res => res.json())
      .then(data => {
        const calendarAM = document.getElementById("calendarAM");
        const calendarPM = document.getElementById("calendarPM");
    
        buildCalendarSection(calendarAM, 7, 14, data.calendar);
        buildCalendarSection(calendarPM, 15, 22, data.calendar);
    
        const dinners = document.getElementById("dinners");
        const todayDinner = data.dinners?.[dayOfWeek];
        if (todayDinner) {
          dinners.innerHTML = `<p><em>${todayDinner.join(', ')}</em></p>`;
        } else {
          dinners.innerHTML = `<p>free for all</p>`;
        }
    
        const birthdays = document.getElementById("birthdays");
        (data.birthdays || []).forEach(b => {
          birthdays.innerHTML += `<p>${b.name}  â€”  <em>${b.date}</em><br></p>`;
        });
    
        const chores = document.getElementById("chores");
        (data.chores?.[dayOfWeek] || []).forEach(chore => {
          chores.innerHTML += `<p>${chore}</p>`;
        });
    
        const reminder = data.reminders?.[dayOfWeek];
        const reminderBox = document.getElementById("reminderBox");
        if (reminder) {
          reminderBox.innerHTML = `<h2>${reminder.title}</h2><p>${reminder.message}</p>`;
          slides.splice(4, 0, "reminder-slide");
        }
      });
  </script>
</body>
</html>

