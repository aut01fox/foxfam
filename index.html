<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Calendar</title>
  <style>
    body {
      margin: 0;
      font-size: 20px;
      font-family: sans-serif;
      background: #f3f2f2;
      color: #333;
    }
    .date-bar {
      background: #007acc;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 1.5em;
      position: fixed;
      width: 100%;
      top: 0;
    }
    .slide {
      display: none;
      padding: 60px 20px 0;
      height: 100vh;
      box-sizing: border-box;
      overflow: hidden;
    }
    .slide.active { display: block; }
    h2 {
      text-align: center;
      font-size: 1.5em;
      margin: 0.5em 0;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: auto repeat(21, 1fr); /* 3 members Ã— 7 days */
      grid-template-rows: auto repeat(32, 1fr); /* 15-min blocks */
      height: calc(100vh - 175px);
    }
    .day-label {
      font-weight: bold;
      text-align: center;
      background-color: #cdcdd1;
      padding: 6px;
      border: 1px solid #ccc;
      font-size: 1em;
      grid-column: span 3;
    }
    .hour-label {
      font-weight: bold;
      text-align: right;
      padding: 0 10px;
      border-right: 1px solid #ccc;
      background-color: #f3f2f2;
      font-size: 0.8em;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }
    .day {
      border: 1px solid #ccc;
      position: relative;
    }
    .event-block {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 2px;
      box-sizing: border-box;
      font-size: 0.8em;
      font-weight: bold;
      display: flex;
      justify-content: center;
      align-items: center;
      white-space: normal;
      word-break: break-word;
      border-radius: 4px;
      color: #000;
    }

    /* Categories */
    .appt { background-color: #ffd966; }
    .school { background-color: #d9ead3; }
    .work { background-color: #f9cb9c; }
    .house { background-color: #a4c2f4; }
    .other { background-color: #e0e0e0; }
  </style>
</head>
<body>
  <div class="date-bar" id="dateBar"></div>
  <div id="slides">
    <div class="slide" id="calendar-am"><h2>Weekly Calendar (AM)</h2><div class="calendar-grid" id="calendarAM"></div></div>
    <div class="slide" id="calendar-pm"><h2>Weekly Calendar (PM)</h2><div class="calendar-grid" id="calendarPM"></div></div>
  </div>

  <script>
    const members = ["Leo", "Autumn", "Cole"];
    const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

    const dateBar = document.getElementById("dateBar");
    const today = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    dateBar.innerText = today.toLocaleDateString(undefined, options);

    function formatTime(hour, minute) {
      const ampm = hour >= 12 ? "PM" : "AM";
      const h = hour % 12 || 12;
      const m = minute.toString().padStart(2, "0");
      return `${h}:${m} ${ampm}`;
    }

    function buildCalendarSection(container, startHour, endHour, calendarData) {
      container.innerHTML = "";

      // Header row
      container.insertAdjacentHTML("beforeend", `<div class="hour-label"></div>`);
      days.forEach(() => {
        container.insertAdjacentHTML("beforeend", `<div class="day-label">${days[container.children.length / 3]}</div>`);
      });

      for (let block = 0; block < (endHour - startHour) * 4 + 1; block++) {
        const hour = Math.floor((startHour * 4 + block) / 4);
        const minute = ((startHour * 4 + block) % 4) * 15;
        const label = formatTime(hour, minute);
        const showLabel = (minute === 0 || minute === 30) ? label : "";

        container.insertAdjacentHTML("beforeend", `<div class="hour-label">${showLabel}</div>`);

        for (let d = 0; d < 7; d++) {
          for (let m = 0; m < 3; m++) {
            container.insertAdjacentHTML("beforeend", `<div class="day" data-day="${days[d]}" data-member="${members[m]}" data-time="${label}"></div>`);
          }
        }
      }

      (calendarData || []).forEach(event => {
        const eventDays = Array.isArray(event.day) ? event.day : [event.day];
        eventDays.forEach(day => {
          const dayIndex = days.indexOf(day);
          const memberIndex = members.indexOf(event.member);
          if (dayIndex === -1 || memberIndex === -1) return;

          const [h, m, meridian] = event.time.match(/^(\d+):(\d+)\s?(AM|PM)$/).slice(1);
          let hour = parseInt(h), minute = parseInt(m);
          if (meridian === "PM" && hour !== 12) hour += 12;
          if (meridian === "AM" && hour === 12) hour = 0;

          const startMinutes = hour * 60 + minute;
          const baseMinutes = startHour * 60;
          const blockIndex = (startMinutes - baseMinutes) / 15;

          const duration = event.duration || 1;

          const eventBlock = document.createElement("div");
          eventBlock.className = `event-block ${event.category}`;
          eventBlock.textContent = event.event;
          eventBlock.style.gridRow = `${blockIndex + 2} / span ${duration}`;
          eventBlock.style.gridColumn = `${1 + dayIndex * 3 + memberIndex + 1}`;

          container.appendChild(eventBlock);
        });
      });
    }

    fetch("assets/data.json")
      .then(res => res.json())
      .then(data => {
        const calendarAM = document.getElementById("calendarAM");
        const calendarPM = document.getElementById("calendarPM");

        const splitEvents = [];
        const cutoffBlock = 14 * 4 + 4;

        (data.calendar || []).forEach(e => {
          const match = e.time.match(/^(\d+):(\d+)\s?(AM|PM)$/);
          if (!match) return;

          let [_, h, m, mer] = match;
          let hour = parseInt(h), minute = parseInt(m);
          if (mer === "PM" && hour !== 12) hour += 12;
          if (mer === "AM" && hour === 12) hour = 0;

          const startBlock = hour * 4 + Math.floor(minute / 15);
          const span = e.duration || 1;
          const endBlock = startBlock + span;

          if (endBlock <= cutoffBlock - 1) {
            splitEvents.push(e);
          } else if (startBlock >= cutoffBlock) {
            splitEvents.push(e);
          } else {
            const amSpan = cutoffBlock - startBlock;
            const pmSpan = span - amSpan;
            const eAM = { ...e, duration: amSpan };
            const ePM = { ...e, duration: pmSpan, time: "3:00 PM" };
            splitEvents.push(eAM, ePM);
          }
        });

        buildCalendarSection(calendarAM, 7, 14.75, splitEvents);
        buildCalendarSection(calendarPM, 15, 22.75, splitEvents);
      });
  </script>
</body>
</html>


